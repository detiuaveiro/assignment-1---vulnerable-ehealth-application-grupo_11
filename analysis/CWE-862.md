## CWE-862: Missing Authorization
- https://cwe.mitre.org/data/definitions/862.html

---
## Descrição

*Missing Authorization* é uma vulnerabilidade que assenta na ausência de autenticação do utilizador, no acesso a determinadas ações ou recursos do sistema.

Na página *Test Results* da aplicação insegura, não é verificado se o utilizador pode ou não aceder a esta página, podendo assim efetuar o download de resultados de outros utilizadores.

Codigo exemplo:
```python
@test_results.route("/test_results", methods=["GET", "POST"])
def show():
    # MISSING -> Verifify user
    if request.method == 'POST':
        # MISSING -> Verifify input
        ...
```

---
## Explorar a vulnerabilidade
Para isso, basta ao utilizador saber a estrutura dos códigos dos testes (no caso, começam por "EHC") e fazer tentativas de acesso aos mesmos.

---
## Solução
Para corrigir este problema, é necessário verificar se o utilizador tem permissão para aceder à pagina e se o teste requisitado pertence ao mesmo.

Codigo exemplo:
```python
@test_results.route("/test_results", methods=["GET", "POST"])
def show():
    if session_ != 'user':
        return redirect(url_for('auth.login'))
    if request.method == 'POST':
        ...
        if cur.execute("SELECT * FROM app_user WHERE id = ? AND email = ?", (id_, test_result[2])).fetchone() is None:
            return render_template("test_results.html", error=True)
```
