## CWE-434: Unrestricted Upload of File with Dangerous Type
- https://cwe.mitre.org/data/definitions/434.html

---
## Descrição

*Unrestricted Upload of File with Dangerous Type* consiste numa vulnerabilidade que surge em aplicações que carecem de mecanismos de verificação de ficheiros submetidos.  

Na página *Reserved Area*, na aba *Upload Test Results*, não é verificado o tipo do ficheiro enviado pelo utilizador.

Isto pode ser explorado para enviar ficheiros maliciosos, que podem ser usados para atacar os utilizadores.

Código exemplo:
```python
if request.method == "POST":
    patient_email = request.form['patient_email']
    file_ = request.files['results_file']
    # MISSING -> Verify file type
    ...
```

---
## Explorar a vulnerabilidade

Para explorar esta vulnerabilidade, basta ao utilizador enviar um ficheiro malicioso.

# TODO -> Mostrar screenshots

---
## Solução

Para corrigir este problema, é necessário verificar o tipo do ficheiro enviado pelo utilizador.

Embora não impeça a exploração da vulnerabilidade, é possível limitar o tipo de ficheiros que podem ser enviados, para ficheiros com a extensão `.pdf`.

Código exemplo:
```python
if request.method == "POST":
    patient_email = request.form['patient_email']
    file_ = request.files['results_file']
    if file_.content_type != 'application/pdf':
        return render_template("reserved_area.html", error="File type is not supported")
```