## CWE-400: Uncontrolled Resource Consumption ('Resource Exhaustion')
- https://cwe.mitre.org/data/definitions/400.html

---
## Descrição

*Uncontrolled Resource Consumption*, também designada por *Resource Exhaustion*, é uma vulnerabilidade que surge em sistemas que carecem de um mecanismo de verificação e gestão de recursos limitados, como é o caso da memória e disco. Este problema pode conduzir a uma exaustão dos recursos disponíveis, afetando assim o normal desempenho do serviço, a sua estabilidade e ainda a sua segurança.

Na página *Reserved Area* e na aba *Upload Test Results* da aplicação insegura, visto que não existe qualquer mecanismo de verificação das características do ficheiro submetido, caso um atacante faça *upload* de vários ficheiros com tamanho elevado, este pode causar um *denial of service* no servidor e, por sua vez, comprometer o desempenho e segurança do sistema.


Código exemplo:
```python
if request.method == "POST":
    patient_email = request.form['patient_email']
    file_ = request.files['results_file']
    # MISSING -> Verify file size
    ...
```

---
## Explorar a vulnerabilidade

Para esse efeito, basta ao utilizador enviar um ficheiro muito grande.

# TODO -> Mostrar screenshots

---
## Solução

Uma das possíveis soluções consiste simplesmente em verificar o tamanho do ficheiro submetido, imediatamente antes de ser armazemado na base de dados.

**Código exemplo**:
```python
if request.method == "POST":
    patient_email = request.form['patient_email']
    file_ = request.files['results_file']
    if len(file_.read()) > 10 * 1024 * 1024:
            return render_template("reserved_area.html", error="File size is too big")
```

