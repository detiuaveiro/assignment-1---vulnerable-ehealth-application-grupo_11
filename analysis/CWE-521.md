## CWE-521: Weak Password Requirements
- https://cwe.mitre.org/data/definitions/521.html

---
## Descrição

*Weak Password Requirements* é uma vulnerabilidade que assenta na ausência de um mecanismo de verificação da complexidade e robustez das passwords. Este tipo de vulnerabilidade reforça a ideia de que nem sempre as fragilidades de um sistema dependem unicamente da sua implementação, mas também dos utilizadores finais. 

Este problema pode ser encontrado na página *Register*, onde não é verificado se a password inserida pelo utilizador é robusta o suficiente. Caso a password escolhida seja demasiado simples, um atacante pode recorrer a técnicas *brute force*, para forçar o login.

Codigo exemplo:
```python
conn = sqlite3.connect('db.sqlite3')
cur = conn.cursor()
if request.method == "POST":
    # Missing password strength validation
    cur.executescript(
        f"INSERT INTO app_user (email, password_, name_) \
            VALUES ('{email}', '{password}', '{full_name}');"
    )
```

---
## Explorar a vulnerabilidade

Como referido anteriormente, uma das abordagens para explorar esta vulnerabilidade seria recorrer a técnicas *brute force*, usando uma lista de passwords comuns.

# TODO -> Mostrar screenshots

---
## Solução

Para corrigir este problema, é necessário verificar se a password inserida pelo utilizador é robusta o suficiente. Uma boa abordagem é criar regras para a sua escolha: conter letras maiúsculas, minúsculas, números, ter um tamanho mínimo, etc.

Codigo exemplo:
```python
conn = sqlite3.connect('db.sqlite3')
cur = conn.cursor()
if request.method == "POST":
    if (
        not re.search(r"[A-Z]", password)
        or not re.search(r"[a-z]", password)
        or not re.search(r"[0-9]", password)
        or len(password) < 8
    ):
        return render_template(
            "register.html", 
            error="Password must have 1 uppercase, 1 lowercase, 1 number, length >= 8"
        )
    cur.execute(
        "INSERT INTO app_user (email, password_, name_) \
            VALUES (? ,?, ?);", (email, password, full_name)
    )
```