## CWE-209: Generation of Error Message Containing Sensitive Information
- https://cwe.mitre.org/data/definitions/209.html

---
## Descrição
Esta vulnerabilidade consiste na geração de mensagens de erro que contêm informações sensíveis do utilizador. Um atacante pode servir-se disso, para explorar outras vulnerabilidades como, por exemplo, a da SQL Injection.

Na página *Doctors*, é executada uma *query* de procura à base de dados. Caso esta não seja bem sucedida, é apresentada uma exceção do módulo ```sqlite3``` do Python, contendo informação sensível.

**Código exemplo**:
```python
conn = sqlite3.connect('db.sqlite3')
cur = conn.cursor()
try:
    doctors = cur.execute(
        f"SELECT app_user.name_, app_user.email, doctor.speciality \
            FROM (doctor JOIN app_user ON doctor.id = app_user.id) \
            WHERE app_user.name_ LIKE '%{user_input}%'"
    ).fetchall()
except Exception as e:
    return render_template(
        "error.html", 
        error=f"Error while fetching data : {str(e)}"
    )
```

---
## Explorar a vulnerabilidade


# TODO -> Mostrar screenshots

---
## Solução

Para mostrar uma mensagem de erro ao utilizador, não é necessária a mensagem de erro original; basta uma genérica.

**Código exemplo**:
```python
conn = sqlite3.connect('db.sqlite3')
cur = conn.cursor()
try:
    doctors = cur.execute(
        f"SELECT app_user.name_, app_user.email, doctor.speciality \
            FROM (doctor JOIN app_user ON doctor.id = app_user.id) \
            WHERE app_user.name_ LIKE ?" , ('%' + user_input + '%')
    ).fetchall()
except:
    return render_template(
        "error.html", 
        error=f"Error while fetching data"
    )
```

